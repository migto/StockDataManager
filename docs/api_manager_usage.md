# TushareAPIManager ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†ä¸¤ä¸ªç‰ˆæœ¬çš„Tushare APIç®¡ç†å™¨ï¼š

1. **å®Œæ•´ç‰ˆ** (`tushare_api_manager.py`) - åŠŸèƒ½å®Œæ•´ï¼ŒåŒ…å«æ•°æ®åº“é›†æˆ
2. **ä¼˜åŒ–ç‰ˆ** (`optimized_tushare_api_manager.py`) - ä¸“ä¸ºå…è´¹è´¦æˆ·ä¼˜åŒ–ï¼Œæ›´ç®€å•æ˜“ç”¨

æ¨èä½¿ç”¨**ä¼˜åŒ–ç‰ˆ**ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…è´¹è´¦æˆ·ç”¨æˆ·ã€‚

## ä¼˜åŒ–ç‰ˆAPIç®¡ç†å™¨ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… ä¸“æ³¨äºdailyæ¥å£ï¼ˆå…è´¹è´¦æˆ·ä¸»è¦å¯ç”¨æ¥å£ï¼‰
- âœ… æ™ºèƒ½é¢‘ç‡æ§åˆ¶ï¼ˆæ¯åˆ†é’Ÿæœ€å¤š2æ¬¡ï¼Œ30ç§’æœ€å°é—´éš”ï¼‰
- âœ… æœ¬åœ°ç¼“å­˜ç­–ç•¥ï¼ˆè‡ªåŠ¨ç¼“å­˜ä¸‹è½½çš„æ•°æ®ï¼‰
- âœ… å†…ç½®äº¤æ˜“æ—¥å†ï¼ˆé¢„é…ç½®26ä¸ªèŠ‚å‡æ—¥ï¼‰
- âœ… æ‰¹é‡ä¸‹è½½æ”¯æŒ
- âœ… å®Œæ•´çš„å‘½ä»¤è¡Œæ¥å£

### æƒé™é™åˆ¶è§£å†³æ–¹æ¡ˆ
| æ¥å£ | å…è´¹è´¦æˆ·é™åˆ¶ | è§£å†³æ–¹æ¡ˆ |
|------|-------------|----------|
| daily | âœ… å¯ç”¨ | ä¸»è¦æ•°æ®æºï¼Œæ™ºèƒ½é¢‘ç‡æ§åˆ¶ |
| stock_basic | âš ï¸ æ¯æ—¥5æ¬¡é™åˆ¶ | æœ¬åœ°ç¼“å­˜ç­–ç•¥ï¼ˆè®¡åˆ’ä¸­ï¼‰ |
| trade_cal | âŒ æ— æƒé™ | ä½¿ç”¨å†…ç½®äº¤æ˜“æ—¥å† |

## å®‰è£…å’Œé…ç½®

### 1. ç¡®ä¿é…ç½®æ­£ç¡®
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
python src/config_manager.py validate

# å¦‚æœéœ€è¦è®¾ç½®Token
python src/config_manager.py set tushare.token YOUR_TOKEN_HERE
```

### 2. éªŒè¯APIè¿æ¥
```bash
# æ£€æŸ¥APIçŠ¶æ€
python src/optimized_tushare_api_manager.py --status
```

## åŸºæœ¬ä½¿ç”¨

### 1. è·å–å•æ—¥æ•°æ®
```bash
# è·å–æŒ‡å®šæ—¥æœŸçš„æ—¥çº¿æ•°æ®
python src/optimized_tushare_api_manager.py --daily 2025-07-11

# è·å–æœ€è¿‘äº¤æ˜“æ—¥çš„æ•°æ®
python src/optimized_tushare_api_manager.py --recent 1
```

### 2. æ‰¹é‡ä¸‹è½½æ•°æ®
```bash
# ä¸‹è½½å•æ—¥æ•°æ®
python src/optimized_tushare_api_manager.py --batch 2025-07-11

# ä¸‹è½½å¤šæ—¥æ•°æ®
python src/optimized_tushare_api_manager.py --batch 2025-07-09,2025-07-11

# ä¸‹è½½æœ€è¿‘å‡ ä¸ªäº¤æ˜“æ—¥
python src/optimized_tushare_api_manager.py --recent 3
```

### 3. æŸ¥çœ‹äº¤æ˜“æ—¥å†
```bash
# æ˜¾ç¤ºæœ€è¿‘10ä¸ªäº¤æ˜“æ—¥
python src/optimized_tushare_api_manager.py --trade-dates 10

# æ˜¾ç¤ºæœ€è¿‘5ä¸ªäº¤æ˜“æ—¥
python src/optimized_tushare_api_manager.py --trade-dates 5
```

### 4. ç¼“å­˜ç®¡ç†
```bash
# æ¸…ç†30å¤©å‰çš„ç¼“å­˜
python src/optimized_tushare_api_manager.py --clear-cache 30

# æ¸…ç†7å¤©å‰çš„ç¼“å­˜
python src/optimized_tushare_api_manager.py --clear-cache 7
```

## ç¼–ç¨‹æ¥å£ä½¿ç”¨

### åŸºæœ¬ç¤ºä¾‹
```python
from optimized_tushare_api_manager import OptimizedTushareAPIManager

# åˆå§‹åŒ–APIç®¡ç†å™¨
api = OptimizedTushareAPIManager()

# è·å–æœ€è¿‘äº¤æ˜“æ—¥çš„æ•°æ®
df = api.get_daily_data()
print(f"è·å–åˆ° {len(df)} æ¡è®°å½•")

# è·å–æŒ‡å®šæ—¥æœŸçš„æ•°æ®
df = api.get_daily_data(trade_date='2025-07-11')

# æ£€æŸ¥APIçŠ¶æ€
status = api.get_api_status()
print(f"ä»Šæ—¥å·²è°ƒç”¨ {status['calls_today']} æ¬¡")
```

### æ‰¹é‡ä¸‹è½½ç¤ºä¾‹
```python
# æ‰¹é‡ä¸‹è½½å¤šæ—¥æ•°æ®
result = api.batch_download_daily_data('2025-07-09', '2025-07-11')
print(f"æˆåŠŸç‡: {result['success_rate']}%")
print(f"æ€»è®°å½•æ•°: {result['total_records']}")
```

### äº¤æ˜“æ—¥å†ç¤ºä¾‹
```python
# æ£€æŸ¥æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
is_trade = api.is_trade_date('2025-07-11')
print(f"2025-07-11 æ˜¯äº¤æ˜“æ—¥: {is_trade}")

# è·å–æœ€è¿‘çš„äº¤æ˜“æ—¥
trade_dates = api.get_recent_trade_dates(5)
print(f"æœ€è¿‘5ä¸ªäº¤æ˜“æ—¥: {trade_dates}")
```

## æ•°æ®æ ¼å¼

### dailyæ¥å£è¿”å›çš„æ•°æ®å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° |
|--------|------|------|
| ts_code | str | è‚¡ç¥¨ä»£ç  |
| trade_date | str | äº¤æ˜“æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰ |
| open | float | å¼€ç›˜ä»· |
| high | float | æœ€é«˜ä»· |
| low | float | æœ€ä½ä»· |
| close | float | æ”¶ç›˜ä»· |
| pre_close | float | æ˜¨æ”¶ä»· |
| change | float | æ¶¨è·Œé¢ |
| pct_chg | float | æ¶¨è·Œå¹…ï¼ˆ%ï¼‰ |
| vol | float | æˆäº¤é‡ï¼ˆæ‰‹ï¼‰ |
| amount | float | æˆäº¤é¢ï¼ˆåƒå…ƒï¼‰ |

### æ•°æ®ç¤ºä¾‹
```csv
ts_code,trade_date,open,high,low,close,pre_close,change,pct_chg,vol,amount
000001.SZ,2025-07-11,13.19,13.30,12.89,12.91,13.18,-0.27,-2.0486,2443743.50,3200219.566
000002.SZ,2025-07-11,6.75,6.79,6.68,6.76,6.76,0.00,0.0000,1628706.59,1099511.183
```

## ç¼“å­˜æœºåˆ¶

### ç¼“å­˜ç›®å½•ç»“æ„
```
data/cache/
â”œâ”€â”€ daily_20250709.csv    # 2025-07-09çš„æ—¥çº¿æ•°æ®
â”œâ”€â”€ daily_20250710.csv    # 2025-07-10çš„æ—¥çº¿æ•°æ®
â””â”€â”€ daily_20250711.csv    # 2025-07-11çš„æ—¥çº¿æ•°æ®
```

### ç¼“å­˜ç‰¹æ€§
- è‡ªåŠ¨ç¼“å­˜æ‰€æœ‰ä¸‹è½½çš„æ•°æ®
- é¿å…é‡å¤APIè°ƒç”¨
- æ”¯æŒæ‰‹åŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜
- CSVæ ¼å¼ï¼Œä¾¿äºExcelç­‰å·¥å…·æ‰“å¼€

## é¢‘ç‡æ§åˆ¶ç­–ç•¥

### å®‰å…¨é™åˆ¶
- **æ¯åˆ†é’Ÿæœ€å¤š2æ¬¡è°ƒç”¨** - ç¬¦åˆTushareå…è´¹è´¦æˆ·é™åˆ¶
- **30ç§’æœ€å°é—´éš”** - é¿å…é¢‘ç¹è°ƒç”¨
- **æ¯æ—¥æœ€å¤š100æ¬¡è°ƒç”¨** - ä¿å®ˆçš„å®‰å…¨é™åˆ¶
- **æ™ºèƒ½ç­‰å¾…æœºåˆ¶** - è‡ªåŠ¨ç­‰å¾…åˆ°å¯ä»¥è°ƒç”¨çš„æ—¶é—´

### è°ƒç”¨ç»Ÿè®¡
```python
# æŸ¥çœ‹ä»Šæ—¥è°ƒç”¨ç»Ÿè®¡
status = api.get_api_status()
print(f"ä»Šæ—¥å·²è°ƒç”¨: {status['calls_today']} æ¬¡")
print(f"ä»Šæ—¥å‰©ä½™: {status['calls_remaining_today']} æ¬¡")
print(f"æœ¬åˆ†é’Ÿå‰©ä½™: {status['calls_this_minute']} æ¬¡")
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **Tokenæœªé…ç½®**
   ```
   é”™è¯¯: Tushare Tokenæœªé…ç½®ï¼Œè¯·å…ˆé…ç½®API Token
   è§£å†³: python src/config_manager.py set tushare.token YOUR_TOKEN
   ```

2. **æƒé™ä¸è¶³**
   ```
   é”™è¯¯: æŠ±æ­‰ï¼Œæ‚¨æ²¡æœ‰æ¥å£è®¿é—®æƒé™
   è§£å†³: è¯¥æ¥å£å…è´¹è´¦æˆ·æ— æƒé™ï¼Œä½¿ç”¨dailyæ¥å£æ›¿ä»£
   ```

3. **é¢‘ç‡é™åˆ¶**
   ```
   é”™è¯¯: æŠ±æ­‰ï¼Œæ‚¨æ¯åˆ†é’Ÿæœ€å¤šè®¿é—®è¯¥æ¥å£1æ¬¡
   è§£å†³: ç­‰å¾…æˆ–ä½¿ç”¨ç¼“å­˜æ•°æ®
   ```

4. **æ— æ•°æ®è¿”å›**
   ```
   æƒ…å†µ: æŒ‡å®šæ—¥æœŸè¿”å›ç©ºæ•°æ®
   åŸå› : å¯èƒ½ä¸æ˜¯äº¤æ˜“æ—¥æˆ–æ•°æ®æœªæ›´æ–°
   è§£å†³: æ£€æŸ¥äº¤æ˜“æ—¥å†æˆ–é€‰æ‹©å…¶ä»–æ—¥æœŸ
   ```

## æ€§èƒ½å»ºè®®

### æœ€ä½³å®è·µ
1. **ä¼˜å…ˆä½¿ç”¨ç¼“å­˜** - é¿å…é‡å¤ä¸‹è½½ç›¸åŒæ•°æ®
2. **æ‰¹é‡ä¸‹è½½** - ä¸€æ¬¡ä¸‹è½½å¤šå¤©æ•°æ®æ›´é«˜æ•ˆ
3. **é¿å…é¢‘ç¹è°ƒç”¨** - åˆ©ç”¨30ç§’é—´éš”å……åˆ†ä½¿ç”¨ç¼“å­˜
4. **åˆç†å®‰æ’æ—¶é—´** - é¿å…åœ¨å¼€ç›˜æ—¶é—´å¤§é‡è°ƒç”¨API

### å…¸å‹ä½¿ç”¨åœºæ™¯
```python
# åœºæ™¯1: æ¯æ—¥æ›´æ–°ï¼ˆæ¨èï¼‰
api = OptimizedTushareAPIManager()
df = api.get_daily_data()  # è·å–æœ€æ–°äº¤æ˜“æ—¥æ•°æ®

# åœºæ™¯2: å†å²æ•°æ®è¡¥å…¨
result = api.batch_download_daily_data('2025-07-01', '2025-07-10')

# åœºæ™¯3: æ•°æ®åˆ†æå‰çš„æ£€æŸ¥
trade_dates = api.get_recent_trade_dates(10)
for date in trade_dates:
    df = api.get_daily_data(date, use_cache=True)  # ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
```

## ä¸æ•°æ®åº“é›†æˆ

è™½ç„¶ä¼˜åŒ–ç‰ˆAPIç®¡ç†å™¨ä¸ç›´æ¥é›†æˆæ•°æ®åº“ï¼Œä½†å¯ä»¥è½»æ¾ä¸æ•°æ®åº“ç³»ç»Ÿç»“åˆï¼š

```python
from database_manager import DatabaseManager
from optimized_tushare_api_manager import OptimizedTushareAPIManager

# åˆå§‹åŒ–
api = OptimizedTushareAPIManager()
db = DatabaseManager()

# è·å–æ•°æ®å¹¶å­˜å‚¨åˆ°æ•°æ®åº“
df = api.get_daily_data('2025-07-11')
if df is not None:
    # è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®åº“å­˜å‚¨é€»è¾‘
    print(f"å¯ä»¥å­˜å‚¨ {len(df)} æ¡è®°å½•åˆ°æ•°æ®åº“")
```

## æ€»ç»“

OptimizedTushareAPIManagerä¸ºå…è´¹è´¦æˆ·ç”¨æˆ·æä¾›äº†ä¸€ä¸ªå®ç”¨ã€å¯é çš„è‚¡ç¥¨æ•°æ®è·å–è§£å†³æ–¹æ¡ˆï¼š

- ğŸ¯ **ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½** - dailyæ¥å£æ»¡è¶³ä¸»è¦éœ€æ±‚
- ğŸ›¡ï¸ **æ™ºèƒ½ä¿æŠ¤** - é¢‘ç‡æ§åˆ¶é¿å…è¶…é™
- ğŸ’¾ **æœ¬åœ°ç¼“å­˜** - å‡å°‘APIè°ƒç”¨ï¼Œæé«˜æ•ˆç‡
- ğŸ“… **å†…ç½®æ—¥å†** - æ— éœ€é¢å¤–æƒé™å³å¯åˆ¤æ–­äº¤æ˜“æ—¥
- ğŸ”„ **æ‰¹é‡æ”¯æŒ** - é«˜æ•ˆä¸‹è½½å†å²æ•°æ®
- ğŸ“‹ **å®Œæ•´æ¥å£** - å‘½ä»¤è¡Œå’Œç¼–ç¨‹ä¸¤ç§ä½¿ç”¨æ–¹å¼

è¿™ä¸ªè®¾è®¡åœ¨å…è´¹è´¦æˆ·é™åˆ¶ä¸‹å®ç°äº†é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸ºåç»­çš„æ•°æ®åˆ†æå’Œå¤„ç†å¥ å®šäº†åšå®åŸºç¡€ã€‚ 